# rocketsciende

Решение задачи октябрьского конкурса ФП: http://thedeemon.livejournal.com/71409.html

## Запуск

Для запуска нужен [leiningen 2](https://github.com/technomancy/leiningen). Запустить можно при помощи команды:

```shell
lein run 10.4 7000
```
Параметры:

* 10.4 - масса полезного груза
* 7000 - бюджет Delta V
* опциональный третий параметр - таймаут в минутах, по умолчанию 2.

Решение, если будет найдено, будет находиться в файле `solution.json`

## Метод решения

### Функция `find-stage`

В основе программе лежит функция `(find-stage total-mass payload dv)` которая пытается подобрать конфигурацию ракеты так, чтобы оно могло поднять с земли ракету массой `total-mass` и донести до пункта назначения полезный груз массой `payload`, обеспечив Delta V `dv`. Задание заранее массы ракеты позволяет строить её с нижних ступеней, независимо от остальных. Т.е. при построении нижней ступени мы знаем, что нам надо поднять `totalMass` тонн и зараннее подбираем двигатели с нужной тягой. Далее высчитываем массу текущей ступени `stageMass` и можем подбирать конфигурацию для ступеней выше имея массу `totalMass - stageMass`. Таким образом отсекаются решения, где на нижних ступенях стоят слабые двигатели.

Используется рекурсия с запоминаями, что сильно ускоряет процесс. Для каждой частичной конфигурации высчитывается её высота, масса и dv. И если для данной высоты уже ранее встречалась конфигурация с меньшей массой и не меньшим dv, то текущая конфигурация дальше не рассматривается.

### Подбор массы

1. В начале ищется любое решение. Для этого ищутся конфигурации с массами 200, 250, 300, 350, ..., 650, 700 (макс масса 700, т.к. двигатели больше не поднимут).
2. Сохраняем текущую конфигурацию.
2. Пусть текущая лучшая конфигурация имеет массу X тонн. Тогда подбираем конфигурации X-10, X-9, X-8, X-7, ..., X-1.
  * Если не нашли, то просто начинаем идти дальше X-11, X-12, X-13 и т.д.
  * Ecли нашли, то сохраняем её как лучшую конфигураяю и переходим опять к пункту 2.

## Параллелизм

Функция `find-stage` хорошо паралеллится, т.е. можно запустить эту функцию с разными параметрами параллельно. Таким образом и поиск начального решения и улучшения решения параллелиться по количеству ядер.
